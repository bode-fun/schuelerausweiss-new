# Setup instructions

## Prerequisites

- Ubuntu 20.04
- docker
- docker-compose
- PHP 8.1
- php8.1-ldap
- php8.1-dom
- php8.1-curl
- php8.1-mysqli
- mysql-server
- zip
- unzip
- composer
- apache2

## First run

### PHP Project

- Setup and start mysql server
  - `sudo service mysql start`
- Clone the repository
- Move into the directory
- Create a database
- Configure the .env file
  - Set `TOKEN_EXPIRATION_MINUTES` to the desired value
  - Configure the database and LDAP-connection
- run `php artisan key:generate`
- run `php artisan migrate`
- Configure apache or run `php artisan serve`
  - Point to the public directory
  - Set `AllowOverride All` in the apache config. This is needed for the `.htaccess` file

### LDAP

- Setup and start docker
  - `sudo service docker start`
- Run `docker-compose up` in the docker directory to start the LDAP server
- Login to <http://localhost:8081> with the following credentials:
  - Username: `cn=admin,dc=yourOrganisation,dc=loc`
  - Password: `admin`
- Import the LDIF text from below
- Login with `Jan` and `hello`

#### LDIF Export

```LDIF
# LDIF Export for dc=yourOrganisation,dc=loc
# Server: openldap (openldap)
# Search Scope: sub
# Search Filter: (objectClass=*)
# Total Entries: 4
#
# Generated by phpLDAPadmin (http://phpldapadmin.sourceforge.net) on November 17, 2022 9:50 am
# Version: 1.2.5

version: 1

# Entry 1: dc=yourOrganisation,dc=loc
dn: dc=yourOrganisation,dc=loc
dc: yourOrganisation
o: yourOrganisation
objectclass: top
objectclass: dcObject
objectclass: organization

# Entry 2: cn=admin,dc=yourOrganisation,dc=loc
dn: cn=admin,dc=yourOrganisation,dc=loc
cn: admin
gidnumber: 501
objectclass: posixGroup
objectclass: top

# Entry 3: cn=Jan,dc=yourOrganisation,dc=loc
dn: cn=Jan,dc=yourOrganisation,dc=loc
carlicense: https://www.bode.fun/IMG_7323_vyfdt5_c_scale,w_1400.png
cn: Jan
objectclass: inetOrgPerson
objectclass: top
roomnumber: WIT3C
sn: Fooken
userpassword: {SSHA}d8O/sNbMjdAskM2kUoMqgCOARXjgOaVc

# Entry 4: cn=user-read-only,dc=yourOrganisation,dc=loc
dn: cn=user-read-only,dc=yourOrganisation,dc=loc
cn: user-read-only
description: LDAP read only user
objectclass: simpleSecurityObject
objectclass: organizationalRole
userpassword: {SSHA}42xX9O0j+6LDr8n0ONw9xt8T1Qsi7OT2
```
